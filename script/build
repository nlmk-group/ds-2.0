#!/bin/bash

echo "🚀 Building NLMK DS 2.0 library..."

yarn convert:dark-theme-tokens

rm -rf lib cache

# Сборка с Vite (включает JS, CSS и типы)
BUILD_MODE=lib yarn vite build

# Копирование ресурсов
echo "📦 Copying static assets..."
mkdir -p lib/css lib/fonts

# Копируем CSS и шрифты
cp -r public/css/* lib/css/ 2>/dev/null || true
cp -r public/fonts/* lib/fonts/ 2>/dev/null || true

# Создаем объединенный CSS файл
cat > lib/css/main.css << 'EOF'
/* NLMK DS 2.0 Styles */
@import './style.css';
@import './temp-variables.css';
@import './dark-theme-storybook.css';
EOF

# Настройка entry points
node script/entryPoints.js

echo "✅ Build completed successfully!"